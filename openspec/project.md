# Project Context

## Purpose

**Scanner111** is a C# port of CLASSIC (Crash Log Auto Scanner & Setup Integrity Checker), a tool for analyzing crash logs from Bethesda games (primarily Fallout 4). The application helps users diagnose game crashes by:

- Parsing crash logs generated by Buffout 4 (a Fallout 4 crash logger mod)
- Identifying problematic plugins, mods, and system configurations
- Generating detailed markdown reports with actionable recommendations
- Validating game file integrity and mod installations

## Tech Stack

- **.NET 9.0** - Target framework
- **Avalonia UI 11.3** - Cross-platform MVVM UI framework (Fluent theme)
- **ReactiveUI** - Reactive MVVM extensions with Fody IL weaving
- **Microsoft.Extensions.DependencyInjection** - IoC container
- **YamlDotNet** - YAML configuration parsing
- **Tomlyn** - TOML file parsing (for mod configs)
- **Microsoft.Data.Sqlite** - SQLite database for FormID lookups
- **xUnit** - Test framework
- **FluentAssertions** - Assertion library
- **Moq** - Mocking framework
- **BenchmarkDotNet** - Performance benchmarking

## Project Conventions

### Code Style

- **Nullable reference types** enabled (`<Nullable>enable</Nullable>`)
- **Implicit usings** enabled for library projects
- **File-scoped namespaces** (e.g., `namespace Scanner111.Common.Services.Parsing;`)
- **XML documentation** on all public interfaces and types
- **Records** for immutable data transfer objects (e.g., `LogParseResult`)
- **Interface prefix** with `I` (e.g., `ILogParser`, `IFileIOService`)
- **Service suffix** for implementations (e.g., `FileIOService`, `UserSettingsService`)

### Architecture Patterns

**Layered Architecture:**
| Project | Purpose |
|---------|---------|
| `Scanner111` | Avalonia MVVM GUI (Windows-targeted) |
| `Scanner111.Common` | Platform-agnostic business logic library |
| `Scanner111.Tests` | GUI/ViewModel tests |
| `Scanner111.Common.Tests` | Business logic tests |
| `Scanner111.Benchmarks` | Performance benchmarks |

**Dependency Injection:**
- Singletons for stateless services (parsers, analyzers, file I/O)
- Transient for stateful per-operation services (orchestrators)
- Factory delegates (`Func<TViewModel>`) for navigation

**MVVM Pattern:**
- ViewModels inherit `ViewModelBase` → `ReactiveObject`
- Use `ReactiveCommand` for user actions
- Shared state via singleton services (`IScanResultsService`, `ISettingsService`)

**Service Layer Organization:**
```
Scanner111.Common/Services/
├── Analysis/        # Plugin analysis, suspect scanning, FormID lookup
├── Configuration/   # YAML config loading and caching
├── Database/        # SQLite FormID database access
├── FileIO/          # File system abstraction
├── Orchestration/   # Pipeline coordination (LogOrchestrator, ScanGameOrchestrator)
├── Parsing/         # Crash log parsing
├── Reporting/       # Markdown report generation
└── Settings/        # User preferences
```

### Testing Strategy

- **Test naming**: `MethodName_Scenario_ExpectedResult`
- **xUnit attributes**: `[Fact]` for simple tests, `[Theory]` + `[InlineData]` for parameterized
- **AAA pattern**: Arrange, Act, Assert with comments
- **Mocking**: Moq for dependencies, FluentAssertions for readable assertions
- **Test data**: Real crash logs in `sample_logs/` directory (1,312 files)

### Async Patterns

- Use `ConfigureAwait(false)` in Scanner111.Common library code
- Accept `CancellationToken` for long-running operations
- Never use `.Result` or `.Wait()` - async all the way

### Git Workflow

- **Main branch**: `main`
- **Issue tracking**: Beads (`bd` CLI) for issue management
- **Commit messages**: Descriptive, prefixed with type (Feat, Fix, Refactor, etc.)

## Domain Context

**Crash Log Structure:**
- Header section with game version, Buffout version, exception type
- `[Compatibility]` section with mod compatibility info
- `SYSTEM SPECS:` section with hardware details
- `MODULES:` section with loaded DLLs
- `PLUGINS:` section with load order (indexed by hex)
- Call stack and register dumps

**Key Concepts:**
- **FormID**: 8-character hex identifier for game records (e.g., `00014321`)
- **Plugin**: `.esm`, `.esp`, or `.esl` file containing game data
- **Load Order**: Priority order of plugins (affects FormID resolution)
- **Buffout 4**: F4SE plugin that generates crash logs

## Important Constraints

- **Windows-only deployment** - Target `net9.0-windows10.0.19041.0` for GUI
- **Never write to `nul`/`NUL`** - Creates undeletable files on Windows
- **Use `Path.Combine()`** - Always for path construction
- **No `--no-build`** - Never use with `dotnet run`/`dotnet test`
- **Don't run `bd sync`** - Let user handle git commits manually

## External Dependencies

- **Sample crash logs**: `sample_logs/` directory with 1,312 real crash logs
- **Reference implementation**: `Code_To_Port/` contains original Python/Rust CLASSIC (read-only)
- **YAML configurations**: Game-specific rules for plugin analysis
- **SQLite database**: FormID lookup database for identifying record sources
