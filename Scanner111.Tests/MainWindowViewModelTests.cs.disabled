using FluentAssertions;
using Scanner111.ViewModels;
using Xunit;

namespace Scanner111.Tests;

/// <summary>
/// Tests for MainWindowViewModel navigation functionality.
/// </summary>
public class MainWindowViewModelTests
{
    [Fact]
    public void GoToHomeCommand_IsNotNull()
    {
        var viewModel = CreateViewModel();
        
        viewModel.GoToHomeCommand.Should().NotBeNull();
    }

    [Fact]
    public void GoToArticlesCommand_IsNotNull()
    {
        var viewModel = CreateViewModel();
        
        viewModel.GoToArticlesCommand.Should().NotBeNull();
    }

    [Fact]
    public void GoToBackupsCommand_IsNotNull()
    {
        var viewModel = CreateViewModel();
        
        viewModel.GoToBackupsCommand.Should().NotBeNull();
    }

    [Fact]
    public void GoToResultsCommand_IsNotNull()
    {
        var viewModel = CreateViewModel();
        
        viewModel.GoToResultsCommand.Should().NotBeNull();
    }

    [Fact]
    public void GoToSettingsCommand_IsNotNull()
    {
        var viewModel = CreateViewModel();
        
        viewModel.GoToSettingsCommand.Should().NotBeNull();
    }

    [Fact]
    public void ExitCommand_IsNotNull()
    {
        var viewModel = CreateViewModel();
        
        viewModel.ExitCommand.Should().NotBeNull();
    }

    [Fact]
    public void CurrentPage_InitiallyNotNull()
    {
        var viewModel = CreateViewModel();
        
        viewModel.CurrentPage.Should().NotBeNull();
    }

    [Fact]
    public void GoToArticlesCommand_ChangesCurrentPage()
    {
        var viewModel = CreateViewModel();
        var initialPage = viewModel.CurrentPage;
        
        viewModel.GoToArticlesCommand.Execute().Subscribe();
        
        viewModel.CurrentPage.Should().NotBeSameAs(initialPage);
        viewModel.CurrentPage.Should().BeOfType<ArticlesViewModel>();
    }

    [Fact]
    public void GoToBackupsCommand_ChangesCurrentPage()
    {
        var viewModel = CreateViewModel();
        
        viewModel.GoToBackupsCommand.Execute().Subscribe();
        
        viewModel.CurrentPage.Should().BeOfType<BackupsViewModel>();
    }

    private static MainWindowViewModel CreateViewModel()
    {
        // Create factories that return simple stubs
        Func<SettingsViewModel> settingsFactory = () => throw new NotSupportedException("SettingsViewModel requires DI");
        Func<HomePageViewModel> homePageFactory = () => throw new NotSupportedException("HomePageViewModel requires DI");
        Func<ResultsViewModel> resultsFactory = () => throw new NotSupportedException("ResultsViewModel requires DI");

        // Override with mock factories for navigation tests
        // For navigation tests, we only need the page types to change
        return new MainWindowViewModel(
            () => null!, // Settings factory - not tested here
            () => new HomePageViewModelStub(),
            () => null!  // Results factory - not tested here
        );
    }

    /// <summary>
    /// Stub for HomePageViewModel to avoid DI dependencies in tests.
    /// </summary>
    private class HomePageViewModelStub : ViewModelBase
    {
    }
}